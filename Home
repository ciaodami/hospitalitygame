<!DOCTYPE html>

<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIELD BOX PREDICTION GAME</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Big+Shoulders+Display:wght@400;600;700;800&display=swap');

```
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
        font-family: 'Big Shoulders Display', sans-serif; 
        background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); 
        min-height: 100vh; 
        padding: 20px; 
        color: #333;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    h1 { text-align: center; color: white; margin-bottom: 40px; font-size: 3em; text-shadow: 3px 3px 6px rgba(0,0,0,0.4); font-weight: 800; letter-spacing: 2px; }
    
    .section { background: #e5e7eb; margin-bottom: 25px; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    .section h2 { color: #dc2626; margin-bottom: 20px; font-size: 2em; border-bottom: 4px solid #dc2626; padding-bottom: 10px; font-weight: 800; }
    
    .players-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .player-card { 
        background: #d1d5db; 
        border-radius: 15px; 
        padding: 25px; 
        text-align: center; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: transform 0.3s;
        position: relative;
    }
    .player-card:hover { transform: translateY(-5px); }
    .player-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(90deg, #dc2626, #991b1b);
    }
    .avatar-container { 
        width: 120px; 
        height: 120px; 
        margin: 0 auto 15px; 
        border-radius: 50%; 
        overflow: hidden; 
        border: 4px solid #dc2626;
        background: #f3f4f6;
        cursor: pointer;
        position: relative;
    }
    .avatar-container img { width: 100%; height: 100%; object-fit: cover; }
    .avatar-container:hover::after {
        content: 'üì∑';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2em;
    }
    .avatar-placeholder { 
        width: 100%; 
        height: 100%; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-size: 3em;
        color: #9ca3af;
    }
    .player-name { font-size: 1.8em; font-weight: 800; margin-bottom: 10px; color: #1f2937; }
    .player-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
    .stat-box { background: #f3f4f6; padding: 10px; border-radius: 8px; }
    .stat-value { font-size: 1.8em; font-weight: 800; color: #dc2626; }
    .stat-label { font-size: 0.9em; color: #6b7280; font-weight: 600; }
    .remove-player-btn { 
        margin-top: 15px; 
        background: #991b1b; 
        color: white; 
        border: none; 
        padding: 8px 15px; 
        border-radius: 8px; 
        cursor: pointer;
        font-family: 'Big Shoulders Display', sans-serif;
        font-weight: 700;
    }
    
    .add-player-section { background: #f9fafb; border: 3px dashed #9ca3af; border-radius: 15px; padding: 30px; text-align: center; }
    .add-player-section input { 
        width: 100%; 
        max-width: 300px; 
        padding: 12px; 
        border: 2px solid #d1d5db; 
        border-radius: 8px; 
        font-size: 1.2em;
        font-family: 'Big Shoulders Display', sans-serif;
        margin-bottom: 15px;
    }
    
    button { 
        background: linear-gradient(135deg, #dc2626, #991b1b); 
        color: white; 
        border: none; 
        padding: 15px 30px; 
        border-radius: 10px; 
        font-size: 1.2em; 
        font-weight: 700; 
        cursor: pointer; 
        transition: transform 0.2s;
        font-family: 'Big Shoulders Display', sans-serif;
    }
    button:hover { transform: translateY(-2px); }
    .btn-success { background: linear-gradient(135deg, #059669, #047857); }
    .btn-secondary { background: linear-gradient(135deg, #6b7280, #4b5563); }
    
    .ranking-item { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 15px; 
        background: #d1d5db; 
        margin: 10px 0; 
        border-radius: 10px; 
        border-left: 6px solid #dc2626;
    }
    .rank-badge { 
        background: #dc2626; 
        color: white; 
        width: 40px; 
        height: 40px; 
        border-radius: 50%; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-weight: 800; 
        font-size: 1.3em;
    }
    
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px; }
    label { display: block; margin-bottom: 8px; font-weight: 700; color: #1f2937; font-size: 1.1em; }
    input, select { 
        width: 100%; 
        padding: 12px; 
        border: 2px solid #9ca3af; 
        border-radius: 8px; 
        font-size: 1.1em;
        font-family: 'Big Shoulders Display', sans-serif;
    }
    input:focus, select:focus { outline: none; border-color: #dc2626; }
    input.error { border-color: #ef4444; }
    .error-message { color: #ef4444; font-size: 0.9em; margin-top: 5px; display: none; font-weight: 600; }
    
    .predictions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .result-card { background: #dcfce7; border-left: 6px solid #16a34a; padding: 25px; margin: 15px 0; border-radius: 10px; }
    
    .chart-container { 
        background: white; 
        padding: 20px; 
        border-radius: 10px; 
        margin: 20px 0;
        min-height: 300px;
    }
    
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
    .stats-card { 
        background: white; 
        padding: 20px; 
        border-radius: 10px; 
        text-align: center;
    }
    .stats-card h3 { color: #dc2626; font-size: 1.5em; margin-bottom: 10px; font-weight: 800; }
    .stats-card .big-number { font-size: 3em; font-weight: 800; color: #1f2937; }
    
    .history-item { background: #d1d5db; margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid #dc2626; }
    .history-match { font-weight: 800; color: #dc2626; margin-bottom: 10px; font-size: 1.3em; }
    .history-predictions { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
    .history-pred { padding: 8px; background: #f3f4f6; border-radius: 5px; text-align: center; }
    
    @media (max-width: 768px) { 
        h1 { font-size: 2em; }
        .players-cards { grid-template-columns: 1fr; }
    }
</style>
```

</head>
<body>
    <div class="container">
        <h1>‚öΩ FIELD BOX PREDICTION GAME</h1>

```
    <div class="section">
        <h2>üë• GIOCATORI</h2>
        <div class="players-cards" id="playersCards"></div>
        <div class="add-player-section">
            <input type="text" id="newPlayerName" placeholder="Nome nuovo giocatore...">
            <button onclick="addPlayer()">‚ûï AGGIUNGI GIOCATORE</button>
        </div>
    </div>
    
    <div class="section">
        <h2>üèÜ CLASSIFICA GENERALE</h2>
        <div id="standingsList"></div>
        <div style="text-align: center; margin-top: 20px; font-size: 1.2em; font-weight: 700;">
            Partite giocate: <span id="matchesPlayed" style="color: #dc2626;">0</span>
        </div>
    </div>
    
    <div class="section">
        <h2>üéØ NUOVA PARTITA</h2>
        <form id="matchForm">
            <div class="form-grid">
                <div>
                    <label for="matchName">PARTITA:</label>
                    <select id="matchName" required>
                        <option value="">Seleziona avversario...</option>
                    </select>
                    <div class="error-message" id="errorMatchPlayed">‚ö†Ô∏è Partita gi√† giocata!</div>
                </div>
                <div>
                    <label for="totalReal">TOTALE REALE:</label>
                    <input type="number" id="totalReal" min="0" max="999" required>
                    <div class="error-message" id="errorTotalReal">‚ö†Ô∏è Numero 0-999</div>
                </div>
            </div>
            
            <label style="margin-top: 20px; margin-bottom: 15px; font-size: 1.3em;">PREVISIONI:</label>
            <div class="predictions-grid" id="predictionsContainer"></div>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px;">
                <button type="submit">üöÄ CALCOLA PUNTEGGIO</button>
                <button type="button" class="btn-success" onclick="exportData()">üì• ESPORTA</button>
                <button type="button" class="btn-secondary" onclick="importData()">üì§ IMPORTA</button>
                <button type="button" class="btn-secondary" onclick="resetSeason()">üîÑ RESET</button>
            </div>
        </form>
    </div>
    
    <div id="currentResultSection" class="section" style="display: none;">
        <h2>üìä RISULTATO PARTITA</h2>
        <div id="currentResult"></div>
    </div>
    
    <div class="section">
        <h2>üìà GRAFICI E STATISTICHE</h2>
        
        <div class="stats-grid">
            <div class="stats-card">
                <h3>Media Punti</h3>
                <div class="big-number" id="avgPoints">0</div>
            </div>
            <div class="stats-card">
                <h3>Totale Partite</h3>
                <div class="big-number" id="totalMatches">0</div>
            </div>
            <div class="stats-card">
                <h3>Miglior Giocatore</h3>
                <div style="font-size: 1.8em; font-weight: 800; color: #dc2626;" id="bestPlayer">-</div>
            </div>
            <div class="stats-card">
                <h3>Vittorie Leader</h3>
                <div class="big-number" id="leaderWins">0</div>
            </div>
        </div>
        
        <div class="chart-container">
            <h3 style="color: #dc2626; margin-bottom: 20px; font-weight: 800;">ANDAMENTO PUNTI</h3>
            <canvas id="pointsChart"></canvas>
        </div>
        
        <div class="chart-container">
            <h3 style="color: #dc2626; margin-bottom: 20px; font-weight: 800;">DISTRIBUZIONE VITTORIE</h3>
            <canvas id="winsChart"></canvas>
        </div>
        
        <div style="margin-top: 30px;">
            <h3 style="color: #dc2626; margin-bottom: 15px; font-weight: 800;">üìã STORICO PARTITE</h3>
            <div id="historyList" style="max-height: 500px; overflow-y: auto;"></div>
        </div>
    </div>
</div>

<input type="file" id="importFileInput" accept=".json" style="display: none;">
<input type="file" id="avatarInput" accept="image/*" style="display: none;">

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
    const serieATeams = ['Inter', 'Juventus', 'Milan', 'Napoli', 'Atalanta', 'Roma', 'Lazio', 'Fiorentina', 'Bologna', 'Torino', 'Udinese', 'Genoa', 'Venezia', 'Parma', 'Verona', 'Lecce', 'Como', 'Monza'];
    
    let players = ['Dami', 'Detti', 'Cice', 'Lu'];
    let standings = {};
    let history = [];
    let avatars = {};
    let pointsChart = null;
    let winsChart = null;
    let currentAvatarPlayer = null;
    
    document.addEventListener('DOMContentLoaded', function() {
        const select = document.getElementById('matchName');
        serieATeams.forEach(team => {
            const option = document.createElement('option');
            option.value = `Cremonese - ${team}`;
            option.textContent = `Cremonese - ${team}`;
            select.appendChild(option);
        });
        loadData();
        updateUI();
    });
    
    function saveData() {
        localStorage.setItem('fieldBoxStandings', JSON.stringify(standings));
        localStorage.setItem('fieldBoxHistory', JSON.stringify(history));
        localStorage.setItem('fieldBoxPlayers', JSON.stringify(players));
        localStorage.setItem('fieldBoxAvatars', JSON.stringify(avatars));
    }
    
    function loadData() {
        const saved = {
            standings: localStorage.getItem('fieldBoxStandings'),
            history: localStorage.getItem('fieldBoxHistory'),
            players: localStorage.getItem('fieldBoxPlayers'),
            avatars: localStorage.getItem('fieldBoxAvatars')
        };
        
        if (saved.standings) standings = JSON.parse(saved.standings);
        if (saved.history) history = JSON.parse(saved.history);
        if (saved.players) players = JSON.parse(saved.players);
        if (saved.avatars) avatars = JSON.parse(saved.avatars);
        
        players.forEach(player => {
            if (!standings[player]) standings[player] = { points: 0, matches: 0, wins: 0 };
        });
    }
    
    function updatePlayerCards() {
        const container = document.getElementById('playersCards');
        container.innerHTML = players.map(player => {
            const stats = standings[player] || { points: 0, matches: 0, wins: 0 };
            const isDefault = ['Dami', 'Detti', 'Cice', 'Lu'].includes(player);
            const avatar = avatars[player] || '';
            
            return `
                <div class="player-card">
                    <div class="avatar-container" onclick="selectAvatar('${player}')">
                        ${avatar ? `<img src="${avatar}" alt="${player}">` : `<div class="avatar-placeholder">üë§</div>`}
                    </div>
                    <div class="player-name">${player}</div>
                    <div class="player-stats">
                        <div class="stat-box">
                            <div class="stat-value">${stats.points}</div>
                            <div class="stat-label">PUNTI</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${stats.wins || 0}</div>
                            <div class="stat-label">VITTORIE</div>
                        </div>
                    </div>
                    ${!isDefault ? `<button class="remove-player-btn" onclick="removePlayer('${player}')">‚úï RIMUOVI</button>` : ''}
                </div>
            `;
        }).join('');
    }
    
    function selectAvatar(player) {
        currentAvatarPlayer = player;
        document.getElementById('avatarInput').click();
    }
    
    document.getElementById('avatarInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file || !currentAvatarPlayer) return;
        
        const reader = new FileReader();
        reader.onload = function(event) {
            avatars[currentAvatarPlayer] = event.target.result;
            saveData();
            updatePlayerCards();
        };
        reader.readAsDataURL(file);
        e.target.value = '';
    });
    
    function addPlayer() {
        const input = document.getElementById('newPlayerName');
        const name = input.value.trim();
        
        if (!name) return alert('‚ö†Ô∏è Inserisci un nome valido!');
        if (players.includes(name)) return alert('‚ö†Ô∏è Giocatore gi√† esistente!');
        
        players.push(name);
        standings[name] = { points: 0, matches: 0, wins: 0 };
        input.value = '';
        saveData();
        updateUI();
    }
    
    function removePlayer(name) {
        if (!confirm(`Rimuovere ${name}?`)) return;
        
        players = players.filter(p => p !== name);
        delete standings[name];
        delete avatars[name];
        saveData();
        updateUI();
    }
    
    function updatePredictionsForm() {
        document.getElementById('predictionsContainer').innerHTML = players.map(player => `
            <div>
                <label for="pred${player}">${player}:</label>
                <input type="number" id="pred${player}" min="0" max="999" required oninput="validateNumber(this)">
                <div class="error-message" id="error${player}">‚ö†Ô∏è 0-999</div>
            </div>
        `).join('');
    }
    
    function validateNumber(input) {
        const value = input.value;
        const errorDiv = document.getElementById('error' + input.id.replace('pred', ''));
        
        if (value === '') {
            input.classList.remove('error');
            if (errorDiv) errorDiv.style.display = 'none';
            return true;
        }
        
        const num = parseFloat(value);
        const isValid = !isNaN(num) && num >= 0 && num <= 999 && /^\d+$/.test(value);
        
        input.classList.toggle('error', !isValid);
        if (errorDiv) errorDiv.style.display = isValid ? 'none' : 'block';
        return isValid;
    }
    
    function isMatchPlayed(matchName) {
        return history.some(game => game.matchName === matchName);
    }
    
    document.getElementById('matchForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const matchName = document.getElementById('matchName').value;
        const totalRealInput = document.getElementById('totalReal');
        const totalReal = parseInt(totalRealInput.value);
        
        if (!validateNumber(totalRealInput)) {
            document.getElementById('errorTotalReal').style.display = 'block';
            totalRealInput.classList.add('error');
            return;
        }
        
        if (isMatchPlayed(matchName)) {
            document.getElementById('errorMatchPlayed').style.display = 'block';
            document.getElementById('matchName').classList.add('error');
            return;
        }
        
        const predictions = {};
        let allValid = true;
        
        players.forEach(player => {
            const input = document.getElementById(`pred${player}`);
            if (!validateNumber(input)) allValid = false;
            else predictions[player] = parseInt(input.value);
        });
        
        if (!allValid) return alert('‚ö†Ô∏è Correggi gli errori!');
        
        const results = players.map(player => ({
            player,
            prediction: predictions[player],
            distance: Math.abs(predictions[player] - totalReal)
        })).sort((a, b) => a.distance !== b.distance ? a.distance - b.distance : a.player.localeCompare(b.player));
        
        const basePoints = [4, 3, 2, 1];
        let currentRank = 0;
        
        for (let i = 0; i < results.length; i++) {
            if (i === 0 || results[i].distance !== results[i-1].distance) currentRank = i;
            results[i].points = basePoints[Math.min(currentRank, 3)];
            
            standings[results[i].player].points += results[i].points;
            standings[results[i].player].matches++;
            if (results[i].points === 4) standings[results[i].player].wins++;
        }
        
        history.unshift({
            matchName,
            totalReal,
            predictions,
            results: results.map(r => ({...r})),
            date: new Date().toLocaleString('it-IT')
        });
        
        saveData();
        showResult(matchName, totalReal, results);
        updateUI();
        
        this.reset();
        document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
        document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
    });
    
    function showResult(matchName, totalReal, results) {
        const section = document.getElementById('currentResultSection');
        const medals = ['ü•á', 'ü•à', 'ü•â', 'üèÖ'];
        
        document.getElementById('currentResult').innerHTML = `
            <div class="result-card">
                <h3 style="color: #16a34a; margin-bottom: 20px; font-size: 1.8em; font-weight: 800;">${matchName}</h3>
                <div style="font-size: 1.5em; font-weight: 800; margin-bottom: 25px;">
                    Totale reale: <span style="color: #dc2626;">${totalReal}</span>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    ${results.map((r, i) => `
                        <div class="ranking-item">
                            <span style="font-size: 1.3em; font-weight: 800;">${medals[i]} ${r.player}</span>
                            <div>
                                <div style="font-size: 1.2em;">${r.prediction}</div>
                                <div style="color: #6b7280;">dist: ${r.distance}</div>
                                <div style="color: #16a34a; font-weight: 800; font-size: 1.3em;">+${r.points}pts</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        section.style.display = 'block';
        section.scrollIntoView({ behavior: 'smooth' });
    }
    
    function updateUI() {
        updatePlayerCards();
        updatePredictionsForm();
        updateStandings();
        updateStats();
        updateCharts();
        updateHistory();
    }
    
    function updateStandings() {
        const sorted = [...players].sort((a, b) => standings[b].points - standings[a].points);
        const badges = ['ü•á', 'ü•à', 'ü•â'];
        
        document.getElementById('standingsList').innerHTML = history.length === 0 ? 
            '<div style="text-align: center; color: #6b7280; padding: 30px;">Nessuna partita</div>' :
            sorted.map((player, i) => `
                <div class="ranking-item">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span class="rank-badge">${badges[i] || (i + 1)}</span>
                        <span style="font-weight: 800; font-size: 1.5em;">${player}</span>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 2em; font-weight: 800; color: #dc2626;">${standings[player].points} pts</div>
                        <div style="color: #6b7280;">${standings[player].matches} partite | ${standings[player].wins} vittorie</div>
                    </div>
                </div>
            `).join('');
        
        document.getElementById('matchesPlayed').textContent = history.length;
    }
    
    function updateStats() {
        const totalPoints = Object.values(standings).reduce((s, st) => s + st.points, 0);
        const totalGames = history.length;
        const avgPoints = totalGames > 0 ? (totalPoints / (players.length * totalGames)).toFixed(1) : 0;
        
        const sorted = [...players].sort((a, b) => standings[b].points - standings[a].points);
        const bestPlayer = sorted[0] || '-';
        const leaderWins = bestPlayer !== '-' ? standings[bestPlayer].wins : 0;
        
        document.getElementById('avgPoints').textContent = avgPoints;
        document.getElementById('totalMatches').textContent = totalGames;
        document.getElementById('bestPlayer').textContent = bestPlayer;
        document.getElementById('leaderWins').textContent = leaderWins;
    }
    
    function updateCharts() {
        const ctx1 = document.getElementById('pointsChart');
        const ctx2 = document.getElementById('winsChart');
        
        if (pointsChart) pointsChart.destroy();
        if (winsChart) winsChart.destroy();
        
        if (history.length === 0) {
            ctx1.getContext('2d').clearRect(0, 0, ctx1.width, ctx1.height);
            ctx2.getContext('2d').clearRect(0, 0, ctx2.width, ctx2.height);
            return;
        }
        
        const colors = ['#dc2626', '#2563eb', '#16a34a', '#f59e0b', '#8b5cf6', '#ec4899'];
        
        pointsChart = new Chart(ctx1, {
            type: 'line',
            data: {
                labels: history.slice().reverse().map((_, i) => `Partita ${i + 1}`),
                datasets: players.map((player, i) => ({
                    label: player,
                    data: history.slice().reverse().map(game => {
                        const result = game.results.find(r => r.player === player);
                        return result ? result.points : 0;
                    }),
                    borderColor: colors[i % colors.length],
                    backgroundColor: colors[i % colors.length] + '20',
                    tension: 0.3
                }))
            },
            options: { responsive: true, plugins: { legend: { position: 'top' } } }
        });
        
        winsChart = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: players,
                datasets: [{
                    label: 'Vittorie',
                    data: players.map(p => standings[p].wins || 0),
                    backgroundColor: colors
                }]
            },
            options: { responsive: true, plugins: { legend: { display: false } } }
        });
    }
    
    function updateHistory() {
        document.getElementById('historyList').innerHTML = history.length === 0 ?
            '<div style="text-align: center; color: #6b7280; padding: 20px;">Nessuna partita</div>' :
            history.map((game, idx) => `
                <div class="history-item">
```
